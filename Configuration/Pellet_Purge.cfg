[gcode_macro Pellet_Purge]
gcode:
    {% set verbose_enable = printer["gcode_macro _KAMP_Settings"].verbose_enable | abs %}  
    {% set tip_distance = printer["gcode_macro _KAMP_Settings"].tip_distance | float %}  
    {% set purge_margin = printer["gcode_macro _KAMP_Settings"].purge_margin | float %}
    {% set travel_speed = (printer.toolhead.max_velocity) * 60 | float %}

    G92 E0
    G0 X{purge_origin_x} Y{purge_origin_y} F{travel_speed}
    G0 Z{purge_height}
    G1 X{purge_end_x} Y{purge_end_y} E{purge_amount} F{purge_speed}
    G0 X{purge_end_x + 5} F{travel_speed}
    G92 E0
